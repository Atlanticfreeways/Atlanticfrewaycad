apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: aws-secrets-manager
  namespace: production
spec:
  provider:
    aws:
      service: SecretsManager
      region: us-east-1
      auth:
        jwt:
          serviceAccountRef:
            name: atlanticfrewaycard-api
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: atlanticfrewaycard-secrets
  namespace: production
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secrets-manager
    kind: SecretStore
  target:
    name: atlanticfrewaycard-secrets
    creationPolicy: Owner
  data:
  - secretKey: DATABASE_URL
    remoteRef:
      key: atlanticfrewaycard/production/database
      property: url
  - secretKey: REDIS_URL
    remoteRef:
      key: atlanticfrewaycard/production/redis
      property: url
  - secretKey: REDIS_PASSWORD
    remoteRef:
      key: atlanticfrewaycard/production/redis
      property: password
  - secretKey: RABBITMQ_URL
    remoteRef:
      key: atlanticfrewaycard/production/rabbitmq
      property: url
  - secretKey: JWT_SECRET
    remoteRef:
      key: atlanticfrewaycard/production/jwt
      property: secret
  - secretKey: JWT_REFRESH_SECRET
    remoteRef:
      key: atlanticfrewaycard/production/jwt
      property: refresh_secret
  - secretKey: MARQETA_APP_TOKEN
    remoteRef:
      key: atlanticfrewaycard/production/marqeta
      property: app_token
  - secretKey: MARQETA_ADMIN_TOKEN
    remoteRef:
      key: atlanticfrewaycard/production/marqeta
      property: admin_token
  - secretKey: MARQETA_WEBHOOK_SECRET
    remoteRef:
      key: atlanticfrewaycard/production/marqeta
      property: webhook_secret
  - secretKey: STRIPE_SECRET_KEY
    remoteRef:
      key: atlanticfrewaycard/production/stripe
      property: secret_key
  - secretKey: SENDGRID_API_KEY
    remoteRef:
      key: atlanticfrewaycard/production/sendgrid
      property: api_key
  - secretKey: INTERNAL_API_KEY
    remoteRef:
      key: atlanticfrewaycard/production/internal
      property: api_key
